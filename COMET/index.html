<!DOCTYPE html>
<html>
<head>
  <title>COMET Dashboard</title>

<meta name="apple-mobile-web-app-capable" content="yes" /> 

<meta name="mobile-web-app-capable" content="yes">
	
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital,wght@1,800&display=swap" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">
  
<link rel="icon" type="image/x-icon" href="/ai2/COMET/assets/Stella Icon.png">  
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
 <script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-database.js"></script>

  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      margin-left: 20px;
	  background-image: url("/ai2/COMET/assets/Stella Rush Background.png")
    }
    h1 {
	  font-family: 'Barlow Condensed', sans-serif;
      font-size: 72px;
      font-weight: bold;
      text-align: left;
      margin-left: 20px;
      margin-top: 40px;
	  color: #ffffff;
    }
    h2 {
      font-size: 52px;
      font-weight: normal;
      text-align: left;
      margin-left: 20px;
      margin-top: 6px;
      margin-bottom: 0;
      padding-bottom: 6px;
	  color: #ffffff;
    }
    .greeting {
	  font-weight: 300;
      font-size: 32px;
      color: #797979;
      margin-left: 20px;
      margin-top: 6px;
      line-height: 1.4;
      margin-bottom: 24px;
	  color: #ffffff;
    }
	.greeting2 {
	  font-weight: 250;
      font-size: 18px;
      color: #797979;
      margin-left: 20px;
      margin-top: 6px;
      line-height: 1.4;
      margin-bottom: 24px;
	  color: #ffffff;
    }
    .menu-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 10vh;
      background: linear-gradient(to top, #9d76c1ff, #ffffff00);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
	  min-height:120px;
    }
    .menu-bar-button {
      display: flex;
      //flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #000000;
      text-decoration: none;
      font-size: 36px;
      padding: 0 20px;
      background-color: transparent;
      flex-grow: 1;
    }
    .dashboard-button {
      background-color: #9d76c1;
      color: #ffffff;
      border-radius: 70px;
      padding: 10px;
      height: 35%;
	  min-height:50px;
    }
    .button-content {
      //display: flex;
      align-items: center;
      justify-content: center;
    }
	.button-content-2 {
      //display: flex;
      align-items: center;
      justify-content: center;
    }
    .button-image {
      width: 40px;
      height: 40px;
    }
	.button-image-2 {
      width: 60px;
      height: 60px;
	  filter: invert(100%);
    }
    .dashboard-button .button-content {
      padding: 0 12px;
	  display: flex;
	align-items: center;
    }
    .dashboard-button .button-image + span {
      padding-left: 12px;
    }
    .ai-chat-button {
      color: #000000;
      align-items: flex-start;
    }
    .account-button {
      color: #000000;
      align-items: flex-start;
    }
	
	
.rectangle-l {
  margin-right:10px;
  margin-left: 20px; 
}

.rectangle-r {
  margin-left:10px;
  margin-right: 20px;
}

.rectangle-all {
border-radius: 75px;
	background-image: linear-gradient(135deg, #aeeeff, #bb8ef6);
	padding-bottom: 15px;
	width: calc(47vw - 20px );
	padding-top: 15px;
}

.rectangle-x {
border-radius: 75px;
	background-image: linear-gradient(135deg, #aeeeff, #bb8ef6);
	padding-bottom: 15px;
	width: 100%;
	height: 100vw;
	padding-top: 15px;
}

.rectangle-t {
border-radius: 75px;
	background-image: linear-gradient(135deg, #aeeeff, #bb8ef6);
	padding-bottom: 15px;
	width: 100%;
	padding-top: 15px;
	text-align: center;
}

.stats {
  display: flex;
  padding-top: 20px;
}

.rectangle-text {
  font-size: 40px;
  font-weight: bold;
  color:#ffffff;
  vertical-align: top;
}

.rectangle-image {
      width: 80px;
      height: 80px;
	  margin-left: 15px;
	  margin-right: 10px;
    }
	
.chart-img {
      width: calc(100% - 30px );
	  margin-left: 15px;
	  margin-right: 10px;
	  margin-top: 7px;
	  border-radius:25px;
	  height:90%;
	  border: none;
    }
	
.section-break{
padding-top: 70px;
}	


.statchooser{
	
	border-radius: 75px;
	width:505px;
	margin: auto;
	text-align: center;
	background-color:#696969;
}

.statbutton{
	border-radius: 75px;
	padding: 15px 25px 15px 25px;
	width:250px;
	border:none;
	font-size:32px;
	font-family: 'Quicksand', sans-serif;
	color:#fff;
}

.statbutton_on{
	background-color: #bb8ef6;
}

.statbutton_off{
	background-color: #fff0;
}

.box {
  
  --v:calc( ((18/5) * var(--p) - 90)*1deg);

  width:200px;
  height:200px;
  display:inline-block;
  border-radius:50%;
  padding:20px;
  background:
    linear-gradient(#ffff,#bb8ef6) content-box,
    linear-gradient(var(--v), #888     50%,transparent 0) 0/min(100%,(50 - var(--p))*100%),
    linear-gradient(var(--v), transparent 50%,var(--c)        0) 0/min(100%,(var(--p) - 50)*100%),
    linear-gradient(to right, #888 50%,var(--c) 0);
  text-align: center;
  margin: 20px 20px 20px 20px;
}

.pie_text{
margin: 0;
-ms-transform: translateY(20%);
transform: translateY(20%);
height:100%;
font-size:40px;
font-family:monospace;
}
  </style>
  <script>
  String.prototype.replacement = function(r){return this.replace(/\{\#\d\}/g, m => r.shift() || m);}
  
var firebaseConfig = {
  apiKey: "AIzaSyAi2nfDKfwYdKJMRawaaAcpY3CiCT9gymQ",
  authDomain: "comet-mobile.firebaseapp.com",
  databaseURL: "https://comet-mobile-default-rtdb.firebaseio.com",
  projectId: "comet-mobile",
  storageBucket: "comet-mobile.appspot.com",
  messagingSenderId: "638054265604",
  appId: "1:638054265604:web:7acaa03089364d0b8c1651"
};

firebase.initializeApp(firebaseConfig);

var database = firebase.database();

var VARIABLE = {};
var COUNTER = 0;
const Dataset = {
	dataset:["Normal/Score/Best","Normal/Rate/Best","Normal/Combo/Best","Normal/Score/Data29","Normal/Rate/Data29","Normal/Combo/Data29"],
	formula:{
		"Normal/Combo/Best": ((x)=>{return (Math.floor(x/10)+1)*10}),
		"Normal/Combo/Data29": ((x)=>{return (Math.floor(x/10)+1)*10})
	}

}

Dataset.dataset.forEach(i=>{
	let j = i;
	database.ref(j).once('value', function(snapshot) {
		console.log(snapshot.val());
		COUNTER++;
		VARIABLE[j] = snapshot.val(); //(Dataset.formula[j] ? Dataset.formula[j](snapshot.val()) : snapshot.val() );
		if (COUNTER==6)wrapper()
	});
})

</script>
  
  <script>
    window.addEventListener('DOMContentLoaded', function() {

		$("#details").hide();
		$(".statbutton_off").css("background-color","#fff0");
		$(".statbutton_on").css("background-color","#bb8ef6");
		$(".statbutton_on").click(function(){
			$(".statbutton_on").css("background-color","#bb8ef6");
			$(".statbutton_off").css("background-color","#fff0");
			$("#details").hide();
			$("#overview").show();
		});
		$(".statbutton_off").click(function(){
			$(".statbutton_off").css("background-color","#bb8ef6");
			$(".statbutton_on").css("background-color","#fff0");
			$("#overview").hide();
			$("#details").show();
		})
    });
	

  </script>
  
  <script>
  function getAPIKey(){
	try{
	return document.cookie.split("apikey"+document.cookie.split("apikeyID=")[1].split(";")[0]+"=")[1].split(";")[0]
	
	}catch(error){
	console.log(error)
	}
}

function wrapper(){
	console.log(VARIABLE)
	let s = ["Normal/Score/Best","Normal/Rate/Best","Normal/Combo/Best","Normal/Score/Data29","Normal/Rate/Data29","Normal/Combo/Data29"].map(w=>VARIABLE[w])
	s[6] = s[0]/600 > 100 ? 100 : s[0]/600;
	$(".pie_score").css("--p",s[6])
	$(".pie_score").html($(".pie_score").html().replace(/<b>.*<\/b>/,"<b>"+s[0]+"</b>"))
	$(".pie_combo").css("--p",s[2])
	$(".pie_combo").html($(".pie_combo").html().replace(/<b>.*<\/b>/,"<b>"+s[2]+"</b>"))
	$(".pie_rtime").css("--p",s[1])
	$(".pie_rtime").html($(".pie_rtime").html().replace(/<b>.*<\/b>/,"<b>"+s[1]+"%</b>"))


	s[7] = s[3]/600 > 100 ? 100 : s[3]/600;
	$(".pie_score29").css("--p",s[7])
	$(".pie_score29").html($(".pie_score29").html().replace(/<b>.*<\/b>/,"<b>"+s[3]+"</b>"))
	$(".pie_combo29").css("--p",s[5])
	$(".pie_combo29").html($(".pie_combo29").html().replace(/<b>.*<\/b>/,"<b>"+s[5]+"</b>"))
	$(".pie_rtime29").css("--p",s[4])
	$(".pie_rtime29").html($(".pie_rtime29").html().replace(/<b>.*<\/b>/,"<b>"+s[4]+"%</b>"))

	$.ajax({
	type:"POST",
	url:"https://api.openai.com/v1/chat/completions",
	headers: {
        "Content-Type":"application/json",
        "Authorization":"Bearer "+window.atob(getAPIKey())
    },
	data:JSON.stringify({
	"model":"gpt-3.5-turbo",
	"messages": [
      {"role": "system","content": "Act as a health analysist.  I have a set of data in a game for you to give feedback."},
      {"role": "user","content": `Score: {#0} out of 60000
Combo: {#1}%
Reaction Time: {#2}%

1. Reply in the following format: "1. You are in {excellent/above-average/average/fair/below-average/poor} health condition, healthier than {x%} of people."
2. Generate a 1-sentence feedback in the following format: "2. Feedback: {Your feedback}"`.replacement(s)}
    ]
	}),
	success: function(q){
		console.log(q);
		var result = q.choices[0].message.content;
		$("#greeting").text(result.match(/You are .* people/)+".")
		$("#greeting2").text(result.match(/(Feedback:)|(2.) .*/)[0].replace("2. ",""))
	}
	});
	
}
  </script>
</head>
<body>
  <h1>COMET Dashboard</h1>
  <h2 id="username">Hi, Chris</h2>
  <p id="greeting" class="greeting">You are in above-average health condition,<br>healthier than 65% of people.</p>
  <p id="greeting2" class="greeting2"></p>

<div class="statchooser">
<button class="statbutton statbutton_on">Overview</button>
<button class="statbutton statbutton_off">Details</button>
</div>
<div style="height:30px"><label>  </label></div>

<div class="overview" id="overview">
<div class="stats section-break">
  
  <div class="rectangle-t rectangle-all">
	<table style="margin: 0 auto;">
	<tr>
	<td>
		<div class="box pie_score29" style="--p:0;--c:#FCD775">
		<div class="pie_text">
		  <label>Score<br><br><b>0%</b></label>
		</div>
		</div>
	</td>
	<td>
		<div class="box pie_combo29" style="--p:0;--c:#FD7676">
		<div class="pie_text">
		  <label>Combo<br><br><b>0</b></label>
		</div>
		</div>
	</td>
	<td>
		<div class="box pie_rtime29" style="--p:0;--c:#9CF491">
		<div class="pie_text">
		  <label>Reaction<br>Time<br><b>0%</b></label>
		</div>
		</div>
	</td>
	</tr>
	</table>
	</div></div>
	
</div>

<div class="details" id="details">
<div class="stats section-break">
  
  <div class="rectangle-t rectangle-all">
	<table style="margin: 0 auto;">
	<tr>
	<td>
		<div class="box pie_score" style="--p:0;--c:#FCD775">
		<div class="pie_text">
		  <label>Score<br><br><b>0%</b></label>
		</div>
		</div>
	</td>
	<td>
		<div class="box pie_combo" style="--p:0;--c:#FD7676">
		<div class="pie_text">
		  <label>Combo<br><br><b>0</b></label>
		</div>
		</div>
	</td>
	<td>
		<div class="box pie_rtime" style="--p:0;--c:#9CF491">
		<div class="pie_text">
		  <label>Reaction<br>Time<br><b>0%</b></label>
		</div>
		</div>
	</td>
	</tr>
	</table>
  </div>
  
</div>

</div>



<div style="height:200px"><label>  </label></div>

  <div class="menu-bar">
    <a href="/ai2/COMET/chat.html" class="menu-bar-button ai-chat-button">
      <div class="button-content">
        <img src="assets/chat-bot.png" alt="AI Chat" class="button-image">
		<br>
        <span>AI Chat</span>
      </div>
    </a>
    <a href="/ai2/COMET/index.html" class="menu-bar-button dashboard-button">
      <div class="button-content">
        <img src="assets/dashboard.png" alt="Dashboard" class="button-image-2">
        <span style="padding-left: 24px;">Dashboard<span>
      </div>
    </a>
    <a href="/ai2/COMET/settings.html" class="menu-bar-button account-button">
      <div class="button-content">
        <img src="assets/user.png" alt="Account" class="button-image">
		<br>
        <span>Account</span>
      </div>
    </a>
  </div>
</body>
</html>
